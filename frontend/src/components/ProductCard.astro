---
const { product } = Astro.props;

const hasStock = product.stock > 0;

// Lógica para etiquetas (esto podrías traerlo de tu base de datos también)
// Por ahora lo simulamos con la info que tenemos:
const isLowStock = product.stock > 0 && product.stock <= 3;
const isNew = product.id > 10; // Ejemplo: si el ID es alto, es nuevo
const isBestSeller = product.price > 5000; // Ejemplo: productos premium
---

<article
  class={`group bg-neutral-900 border border-neutral-800 rounded-2xl overflow-hidden 
  transition-all duration-300 hover:border-rose-300 ${!hasStock && "opacity-75"}`}
>
  <div class="relative aspect-[3/4] overflow-hidden bg-neutral-800">
    <div class="absolute top-3 left-3 z-10 flex flex-col gap-2">
      {isNew && (
        <span class="bg-emerald-500 text-white text-[10px] font-bold px-2 py-1 rounded-md uppercase">Nuevo</span>
      )}
      {isBestSeller && (
        <span class="bg-amber-500 text-white text-[10px] font-bold px-2 py-1 rounded-md uppercase">Más vendido</span>
      )}
      {isLowStock && (
        <span class="bg-rose-600 text-white text-[10px] font-bold px-2 py-1 rounded-md uppercase">Pocas unidades</span>
      )}
    </div>

    <img
      src={`http://127.0.0.1:8000${product.image_url}`}
      alt={product.name}
      class="w-full h-full object-cover transition duration-500 group-hover:scale-110"
    />
  </div>

  <div class="p-4 space-y-3">
    <div>
      <h3 class="text-sm font-medium tracking-wide text-neutral-100 uppercase truncate">
        {product.name}
      </h3>
      <p class={`text-[11px] mt-1 ${hasStock ? "text-neutral-400" : "text-rose-500 font-bold"}`}>
        {hasStock ? `Stock disponible: ${product.stock}` : "AGOTADO"}
      </p>
    </div>

    <div class="text-rose-300 font-bold text-lg">
      ${product.price}
    </div>

    <div class="grid grid-cols-2 gap-2 pt-2">
      <a
        href={`/products/${product.id}`}
        class="text-center text-[11px] font-semibold bg-neutral-800 text-neutral-200 py-2 rounded-full hover:bg-neutral-700 transition"
      >
        Ver detalle
      </a>

      {hasStock ? (
        <a
          href={`https://wa.me/5493571620225?text=¡Hola! Me interesa el producto: ${product.name}`}
          target="_blank"
          class="text-center text-[11px] font-semibold bg-rose-300 text-neutral-950 py-2 rounded-full hover:bg-rose-400 transition"
        >
          Consultar
        </a>
      ) : (
        <button disabled class="text-center text-[11px] font-semibold bg-neutral-800 text-neutral-500 py-2 rounded-full cursor-not-allowed">
          Sin stock
        </button>
      )}
    </div>
  </div>
</article>